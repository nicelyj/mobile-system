<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="BoardList">
	<cacheModel id="boardCache" type="LRU" readOnly="true" serialize="false">
		<property name="size" value="500" />
		<flushOnExecute statement="BoardList.dummySql"/>
		<flushOnExecute statement="BoardList.insertBoard"/>
		<flushOnExecute statement="BoardList.updateBoard"/>
		<flushOnExecute statement="BoardList.deleteBoard"/>
		<flushInterval hours="1"/>
	</cacheModel>
	
	<statement id="dummySql">
		SELECT 1
	</statement>
	
	<!-- 보드입력 -->
	<insert id="insertBoard" parameterClass="com.song7749.mds.board.model.Board">
		INSERT INTO Board set 
		<dynamic>
			<isGreaterThan property="boardSeq" compareValue="0">
				boardSeq=#boardSeq#
			</isGreaterThan>
		</dynamic>
		boardName = '$boardName$'
		<selectKey keyProperty="boardSeq" resultClass="Integer">
			SELECT LAST_INSERT_ID()
		</selectKey>
	</insert>

	<!-- 보드 수정 -->
	<update id="updateBoard" parameterClass="com.song7749.mds.board.model.Board">
		UPDATE Board SET BoardName='$boardName$' WHERE boardSeq=#boardSeq#
	</update>

	<!-- 보드삭제 -->
	<delete id="deleteBoard" parameterClass="com.song7749.mds.board.model.Board">
		DELETE FROM Board WHERE 1=1 
		<dynamic>
			<isGreaterThan property="boardSeq" compareValue="0">
				AND boardSeq=#boardSeq#
			</isGreaterThan>
			<isNotEmpty property="boardName">
				AND boardName='$boardName$'
			</isNotEmpty>
		</dynamic>
	</delete>
	
	<!-- 보드 목록 리스트 맵 -->
	<resultMap class="com.song7749.mds.board.model.Board" id="Board-result">
		<result property="boardSeq" column="boardSeq"/>
		<result property="boardName" column="boardName" />
	</resultMap>

	<!-- 보드목록 조회 -->
	<sql id="selectBoardSql">
		SELECT boardSeq,boardName FROM Board WHERE 1=1
		<dynamic>
			<isGreaterThan property="boardSeq" compareValue="0">
				AND boardSeq=#boardSeq#
			</isGreaterThan>
			<isNotEmpty property="boardName">
				AND boardName='$boardName$'
			</isNotEmpty>
		</dynamic>
	</sql>
	<select id="selectBoards" parameterClass="com.song7749.mds.board.model.Board" resultMap="Board-result">
		<include refid="selectBoardSql"/>
	</select>
	<select id="selectBoardsCaches" parameterClass="com.song7749.mds.board.model.Board" resultMap="Board-result" cacheModel="BoardList.boardCache" >
		<include refid="selectBoardSql"/>
	</select>
	<!-- 보드목록 조회 끝 -->
</sqlMap>